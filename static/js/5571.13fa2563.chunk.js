"use strict";(self.webpackChunkapp_frontend=self.webpackChunkapp_frontend||[]).push([[5571],{74510:function(e,n,r){var t=r(76747),a=r(86495),i=r(26319),l=r(71945),o=(0,t.P1)([a.Z.selectCurrentTenant,a.Z.selectCurrentUser],(function(e,n){return new i.Z(e,n).match(l.Z.values.palierRead)})),u=(0,t.P1)([a.Z.selectCurrentTenant,a.Z.selectCurrentUser],(function(e,n){return new i.Z(e,n).match(l.Z.values.palierEdit)})),s=(0,t.P1)([a.Z.selectCurrentTenant,a.Z.selectCurrentUser],(function(e,n){return new i.Z(e,n).match(l.Z.values.palierCreate)})),c=(0,t.P1)([a.Z.selectCurrentTenant,a.Z.selectCurrentUser],(function(e,n){return new i.Z(e,n).match(l.Z.values.palierImport)})),d={selectPermissionToRead:o,selectPermissionToEdit:u,selectPermissionToCreate:s,selectPermissionToDestroy:(0,t.P1)([a.Z.selectCurrentTenant,a.Z.selectCurrentUser],(function(e,n){return new i.Z(e,n).match(l.Z.values.palierDestroy)})),selectPermissionToImport:c};n.Z=d},6891:function(e,n,r){r.d(n,{Z:function(){return x}});var t=r(70885),a=r(15861),i=r(15671),l=r(43144),o=r(87757),u=r.n(o),s=r(99811),c=r.n(s),d=r(10499),m=r(63922),f=r(71351),p=r(81384),v=r(31881),h=r.n(v),x=function(){function e(){(0,i.Z)(this,e)}return(0,l.Z)(e,null,[{key:"validate",value:function(e,n){if(n){if(n.image&&!e.type.startsWith("image"))throw new Error((0,d.ag)("fileUploader.image"));if(n.storage.maxSizeInBytes&&e.size>n.storage.maxSizeInBytes)throw new Error((0,d.ag)("fileUploader.size",c()(n.storage.maxSizeInBytes)));var r=b(e.name);if(n.formats&&!n.formats.includes(r))throw new Error((0,d.ag)("fileUploader.formats",n.formats.join(", ")))}}},{key:"upload",value:function(){var e=(0,a.Z)(u().mark((function e(n,r){var t,a,i,l,o,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.validate(n,r),e.next=7;break;case 4:return e.prev=4,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 7:return t=b(n.name),a=(0,f.Z)(),i="".concat(a,".").concat(t),e.next=12,this.fetchFileCredentials(i,r);case 12:return l=e.sent,o=l.uploadCredentials,s=l.downloadUrl,c=l.privateUrl,e.next=18,this.uploadToServer(n,o);case 18:return e.abrupt("return",{id:a,name:n.name,sizeInBytes:n.size,publicUrl:o&&o.publicUrl?o.publicUrl:null,privateUrl:c,downloadUrl:s,new:!0});case 19:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(n,r){return e.apply(this,arguments)}}()},{key:"fetchFileCredentials",value:function(){var e=(0,a.Z)(u().mark((function e(n,r){var t,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.Z.get(),e.next=3,m.Z.get("/tenant/".concat(t,"/file/credentials"),{params:{filename:n,storageId:r.storage.id}});case 3:return a=e.sent,i=a.data,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}()},{key:"uploadToServer",value:function(){var e=(0,a.Z)(u().mark((function e(n,r){var a,i,l,o,s,c,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,a=r.url,i=new FormData,l=0,o=Object.entries(r.fields||{});l<o.length;l++)s=(0,t.Z)(o[l],2),c=s[0],d=s[1],i.append(c,d);return i.append("file",n),e.abrupt("return",h().post(a,i,{headers:{"Content-Type":"multipart/form-data"}}));case 8:throw e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(n,r){return e.apply(this,arguments)}}()}]),e}();function b(e){if(!e)return null;var n=/(?:\.([^.]+))?$/.exec(e);return n?n[1]:null}},89994:function(e,n,r){var t=r(42982),a=r(42277),i=r(10499),l=r(70816),o=r.n(l),u={generic:function(e){return a.nK().label(e)},string:function(e,n){n=n||{};var r=a.Z_().transform((function(e,n){return""===n?null:e})).nullable(!0).trim().label(e);return n.required&&(r=r.required()),(n.min||0===n.min)&&(r=r.min(n.min)),n.max&&(r=r.max(n.max)),n.matches&&(r=r.matches(n.matches)),r},boolean:function(e,n){return a.Xg().default(!1).label(e)},relationToOne:function(e,n){n=n||{};var r=a.nK().nullable(!0).label(e).transform((function(e,n){return n?n.id:null}));return n.required&&(r=r.required()),r},stringArray:function(e,n){n=n||{};var r=a.IX().compact().ensure().of(a.Z_().transform((function(e,n){return""===n?null:e})).trim()).label(e);return(n.required||n.min)&&(r=r.required()),n.min||0===n.min?r=r.min(n.min):n.required&&(r=r.min(1)),n.max&&(r=r.max(n.max)),r},relationToMany:function(e,n){n=n||{};var r=a.IX().nullable(!0).label(e).transform((function(e,n){return n&&n.length?n.map((function(e){return e.id})):[]}));return(n.required||n.min)&&(r=r.required()),n.min||0===n.min?r=r.min(n.min):n.required&&(r=r.min(1)),n.max&&(r=r.max(n.max)),r},integer:function(e,n){n=n||{};var r=a.Rx().transform((function(e,n){return""===n?null:e})).integer().nullable(!0).label(e);return n.required&&(r=r.required()),(n.min||0===n.min)&&(r=r.min(n.min)),n.max&&(r=r.max(n.max)),r},images:function(e,n){n=n||{};var r=a.IX().nullable(!0).label(e);return(n.required||n.min)&&(r=r.required()),n.min||0===n.min?r=r.min(n.min):n.required&&(r=r.min(1)),n.max&&(r=r.max(n.max)),r},files:function(e,n){n=n||{};var r=a.IX().compact().ensure().nullable(!0).label(e);return(n.required||n.min)&&(r=r.required()),n.min||0===n.min?r=r.min(n.min):n.required&&(r=r.min(1)),n.max&&(r=r.max(n.max)),r},enumerator:function(e,n){n=n||{};var r=a.Z_().transform((function(e,n){return""===n?null:e})).label(e).nullable(!0).oneOf([null].concat((0,t.Z)(n.options||[])));return n.required&&(r=r.required((0,i.ag)("validation.string.selected"))),r},email:function(e,n){n=n||{};var r=a.Z_().transform((function(e,n){return""===n?null:e})).nullable(!0).trim().label(e).email();return n.required&&(r=r.required()),(n.min||0===n.min)&&(r=r.min(n.min)),n.max&&(r=r.max(n.max)),n.matches&&(r=r.matches(n.matches)),r},decimal:function(e,n){n=n||{};var r=a.Rx().transform((function(e,n){return""===n?null:e})).nullable(!0).label(e);return n.required&&(r=r.required()),(n.min||0===n.min)&&(r=r.min(n.min)),n.max&&(r=r.max(n.max)),r},datetime:function(e,n){n=n||{};var r=a.nK().nullable(!0).label(e).transform((function(e,n){return e?o()(n,"YYYY-MM-DD HH:mm").toISOString():null}));return n.required&&(r=r.required()),r},date:function(e,n){n=n||{};var r=a.nK().nullable(!0).label(e).test("is-date",(0,i.ag)("validation.mixed.default"),(function(e){return!e||o()(e,"YYYY-MM-DD").isValid()})).transform((function(e){return e?o()(e).format("YYYY-MM-DD"):null}));return n.required&&(r=r.required()),r}};n.Z=u},78428:function(e,n,r){r.d(n,{Z:function(){return I}});var t=r(1413),a=r(42982),i=r(70885),l=r(47313),o=r(76071),u=r(15861),s=r(87757),c=r.n(s),d=r(1168),m=r(10499),f=r(33512),p=r(43270),v=r(89994),h=r(95748),x=r(68160),b=r(42277),g=r(67357),Z=r(47575),j=r(30513),w=r(25969),y=r(63849),C=r(31616),q=r(46417),k=b.Ry().shape({title:v.Z.string((0,m.ag)("entities.palier.fields.title"),{required:!0}),montant:v.Z.decimal((0,m.ag)("entities.palier.fields.montant"),{required:!0}),details:v.Z.string((0,m.ag)("entities.palier.fields.details"),{required:!0})});var N=function(e){var n=(0,l.useState)((function(){var n=e.record||{};return{title:n.title,montant:n.montant,details:n.details}})),r=(0,i.Z)(n,1)[0],a=(0,p.cI)({resolver:(0,g.X)(k),mode:"all",defaultValues:r}),o=function(n){var r;e.onSubmit(null===(r=e.record)||void 0===r?void 0:r.id,n)};return(0,q.jsx)(x.Z,{children:(0,q.jsx)(p.RV,(0,t.Z)((0,t.Z)({},a),{},{children:(0,q.jsxs)("form",{onSubmit:a.handleSubmit(o),children:[(0,q.jsx)(w.Z,{children:(0,q.jsxs)(y.Z,{style:{paddingBottom:"10px"},children:[(0,q.jsx)(C.Z,{sm:3,children:(0,q.jsx)(Z.Z,{name:"title",label:(0,m.ag)("entities.palier.fields.title"),required:!0,autoFocus:!0})}),(0,q.jsx)(C.Z,{sm:3,children:(0,q.jsx)(Z.Z,{name:"montant",label:(0,m.ag)("entities.palier.fields.montant"),required:!0})}),(0,q.jsx)(C.Z,{sm:6,children:(0,q.jsx)(j.Z,{name:"details",label:(0,m.ag)("entities.palier.fields.details"),required:!0})})]})}),(0,q.jsxs)("div",{className:"form-buttons",children:[(0,q.jsxs)("button",{className:"btn btn-primary",disabled:e.saveLoading,type:"button",onClick:a.handleSubmit(o),children:[(0,q.jsx)(h.Z,{loading:e.saveLoading,iconClass:"far fa-save"}),"\xa0",(0,m.ag)("common.save")]}),(0,q.jsxs)("button",{className:"btn btn-light",type:"button",disabled:e.saveLoading,onClick:function(){Object.keys(r).forEach((function(e){a.setValue(e,r[e])}))},children:[(0,q.jsx)("i",{className:"fas fa-undo"}),"\xa0",(0,m.ag)("common.reset")]}),e.onCancel?(0,q.jsxs)("button",{className:"btn btn-light",type:"button",disabled:e.saveLoading,onClick:function(){return e.onCancel()},children:[(0,q.jsx)("i",{className:"fas fa-times"}),"\xa0",(0,m.ag)("common.cancel")]}):null]})]})}))})};var S=function(e){var n=(0,l.useRef)(),r=(0,l.useState)(!1),t=(0,i.Z)(r,2),a=t[0],s=t[1];(0,l.useEffect)((function(){window.$(n.current).modal("show"),window.$(n.current).on("hidden.bs.modal",e.onClose)}),[]);var p=function(){var r=(0,u.Z)(c().mark((function r(t,a){var i,l,u;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,s(!0),r.next=4,o.Z.create(a);case 4:return i=r.sent,l=i.id,r.next=8,o.Z.find(l);case 8:u=r.sent,window.$(n.current).modal("hide"),e.onSuccess(u),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(0),f.Z.handle(r.t0);case 16:return r.prev=16,s(!1),r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[0,13,16,19]])})));return function(e,n){return r.apply(this,arguments)}}();return d.createPortal((0,q.jsx)("div",{ref:n,className:"modal",tabIndex:-1,children:(0,q.jsx)("div",{className:"modal-dialog modal-lg",children:(0,q.jsxs)("div",{className:"modal-content",children:[(0,q.jsxs)("div",{className:"modal-header",children:[(0,q.jsx)("h5",{className:"modal-title",children:(0,m.ag)("entities.palier.new.title")}),(0,q.jsx)("button",{type:"button",className:"close","data-dismiss":"modal",children:(0,q.jsx)("span",{children:"\xd7"})})]}),(0,q.jsx)("div",{className:"modal-body",children:(0,q.jsx)(N,{saveLoading:a,onSubmit:p,onCancel:function(){window.$(n.current).modal("hide")},modal:!0})})]})})}),document.getElementById("modal-root"))},P=r(49513),T=r(45788),U=r(74510);var I=function(e){var n=(0,p.Gc)(),r=n.setValue,u=n.getValues,s=(0,l.useState)(!1),c=(0,i.Z)(s,2),d=c[0],m=c[1],f=(0,T.v9)(U.Z.selectPermissionToCreate),v=function(){m(!1)};return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(P.Z,(0,t.Z)((0,t.Z)({},e),{},{fetchFn:function(e,n){return o.Z.listAutocomplete(e,n)},mapper:{toAutocomplete:function(e){if(!e)return null;var n=e.id,r=e.label;return e.title&&(r=e.title),{key:n,value:n,label:r}},toValue:function(e){return e?{id:e.value,label:e.label}:null}},onOpenModal:function(){m(!0)},hasPermissionToCreate:f})),d&&(0,q.jsx)(S,{onClose:v,onSuccess:function(n){var t=e.name,i=e.mode;r(t,i&&"multiple"===i?[].concat((0,a.Z)(u()[t]||[]),[n]):n),v()}})]})}},49384:function(e,n,r){r.d(n,{Z:function(){return i}});var t=r(15671),a=r(43144),i=function(){function e(){(0,t.Z)(this,e)}return(0,a.Z)(e,null,[{key:"errorMessage",value:function(e,n,r,t){var a,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(i)return i;if(!t&&!r[e])return null;var l=n[e];return(null===l||void 0===l||null===(a=l[0])||void 0===a?void 0:a.message)||(null===l||void 0===l?void 0:l.message)||l||null}}]),e}()},30513:function(e,n,r){r(47313);var t=r(43270),a=r(49384),i=r(46417);function l(e){var n=e.label,r=e.name,l=e.hint,o=e.size,u=e.placeholder,s=e.autoFocus,c=e.autoComplete,d=e.externalErrorMessage,m=e.required,f={small:"col-form-label-sm",large:"col-form-label-lg"}[o]||"",p={small:"form-control-sm",large:"form-control-lg"}[o]||"",v=(0,t.Gc)(),h=v.register,x=v.errors,b=v.formState,g=b.touched,Z=b.isSubmitted,j=a.Z.errorMessage(r,x,g,Z,d);return(0,i.jsxs)("div",{className:"form-group",children:[Boolean(n)&&(0,i.jsx)("label",{className:"col-form-label ".concat(m?"required":null," ").concat(f),htmlFor:r,children:n}),(0,i.jsx)("textarea",{id:r,name:r,ref:h,onChange:function(n){e.onChange&&e.onChange(n.target.value)},onBlur:function(n){e.onBlur&&e.onBlur(n)},placeholder:u||void 0,autoFocus:s||void 0,autoComplete:c||void 0,className:"form-control ".concat(p," ").concat(j?"is-invalid":"")}),(0,i.jsx)("div",{className:"invalid-feedback",children:j}),Boolean(l)&&(0,i.jsx)("small",{className:"form-text text-muted",children:l})]})}l.defaultProps={required:!1},n.Z=l},68160:function(e,n,r){var t,a=r(30168),i=r(91876).ZP.div(t||(t=(0,a.Z)(["\n  padding-top: 0;\n  padding-bottom: 0;\n\n  label.required::before {\n    display: inline-block;\n    margin-right: 4px;\n    content: '*';\n    line-height: 1;\n    font-size: 13px;\n    color: #f5222d;\n  }\n  .app__specification {\n    padding: 14px;\n  }\n  .react-datepicker-wrapper {\n    width: 100%;\n  }\n  i {\n    padding-right: 4px;\n    font-size: 14px;\n  }\n  .adherent-control {\n    z-index: 0;\n  }\n\n  .invalid-feedback {\n    display: block;\n  }\n\n  .form-buttons {\n    padding-top: 16px;\n\n    .btn {\n      margin-right: 8px;\n      margin-bottom: 8px;\n    }\n  }\n"])));n.Z=i},25969:function(e,n,r){var t,a=r(30168),i=r(91876).ZP.div(t||(t=(0,a.Z)(["\n  .btn.btn-link {\n    padding-left: 0;\n  }\n"])));n.Z=i},10619:function(e,n,r){var t=r(42982),a=r(15861),i=r(70885),l=r(87757),o=r.n(l),u=r(47313),s=r(6891),c=r(33512),d=r(10499),m=r(95748),f=r(46417);n.Z=function(e){var n=(0,u.useState)(!1),r=(0,i.Z)(n,2),l=r[0],p=r[1],v=(0,u.useRef)(),h=function(){var n=e.value;return n?Array.isArray(n)?n:[n]:[]},x=function(){var n=(0,a.Z)(o().mark((function n(r){var a,i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,(a=r.target.files)&&a.length){n.next=4;break}return n.abrupt("return");case 4:return i=a[0],s.Z.validate(i,{storage:e.storage,formats:e.formats}),p(!0),n.next=9,s.Z.upload(i,{storage:e.storage,formats:e.formats});case 9:i=n.sent,v.current.value="",p(!1),e.onChange([].concat((0,t.Z)(h()),[i])),n.next=21;break;case 15:n.prev=15,n.t0=n.catch(0),v.current.value="",console.error(n.t0),p(!1),c.Z.showMessage(n.t0);case 21:case"end":return n.stop()}}),n,null,[[0,15]])})));return function(e){return n.apply(this,arguments)}}(),b=e.max,g=e.readonly,Z=(0,f.jsxs)("label",{className:"btn btn-outline-secondary px-4 mb-2",style:{cursor:"pointer"},children:[(0,f.jsx)(m.Z,{loading:l,iconClass:"fas fa-plus"}),(0,d.ag)("fileUploader.upload"),(0,f.jsx)("input",{style:{display:"none"},disabled:l||g,accept:function(){var n=e.schema;if(n&&n.formats)return n.formats.map((function(e){return".".concat(e)})).join(",")}(),type:"file",onChange:x,ref:v})]});return(0,f.jsxs)("div",{children:[g||b&&h().map((function(e){return{uid:e.id||void 0,name:e.name,status:"done",url:e.downloadUrl}})).length>=b?null:Z,h()&&h().length?(0,f.jsx)("div",{children:h().map((function(n){return(0,f.jsxs)("div",{children:[(0,f.jsx)("i",{className:"fas fa-link text-muted mr-2"}),(0,f.jsx)("a",{href:n.downloadUrl,target:"_blank",rel:"noopener noreferrer",download:!0,children:n.name}),!g&&(0,f.jsx)("button",{className:"btn btn-link",type:"button",onClick:function(){return r=n.id,void e.onChange(h().filter((function(e){return e.id!==r})));var r},children:(0,f.jsx)("i",{className:"fas fa-times"})})]},n.id)}))}):null]})}},48317:function(e,n,r){var t=r(1413),a=r(42982),i=r(70885),l=r(47313),o=r(74773),u=r(70713),s=r(49513),c=r(43270),d=r(45788),m=r(15021),f=r(46417);n.Z=function(e){var n=(0,c.Gc)(),r=n.setValue,p=n.getValues,v=(0,l.useState)(!1),h=(0,i.Z)(v,2),x=h[0],b=h[1],g=(0,d.v9)(m.Z.selectPermissionToCreate);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(s.Z,(0,t.Z)((0,t.Z)({},e),{},{fetchFn:function(e,n){return o.Z.fetchUserAutocomplete(e,n)},mapper:{toAutocomplete:function(e){if(!e)return null;if(e.fullName||e.email){var n=e.email;return e.fullName&&(n="".concat(e.fullName," <").concat(e.email,">")),{value:e.id,label:n}}return{value:e.id,label:e.label}},toValue:function(e){return e?{id:e.value,label:e.label}:null}},onOpenModal:function(){return b(!0)},hasPermissionToCreate:g})),x&&(0,f.jsx)(u.Z,{visible:x,onClose:function(){return b(!1)},onSuccess:function(n){var t=e.name,i=e.mode;r(t,i&&"multiple"===i?[].concat((0,a.Z)(p()[t]||[]),[n]):n),b(!1)}})]})}}}]);